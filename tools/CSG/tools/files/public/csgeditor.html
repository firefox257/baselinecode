

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, user-scalable=no" />
        <title>CSG Editor - Mobile</title>
        <style>
            body,
            html {
                margin: 0;
                padding: 0;
                width: 100%;
                height: 100%;
                overflow: hidden;
                font-family: 'Segoe UI', sans-serif;
                background: #1e1e1e;
                color: white;
            }

            #toolbar {
                display: flex;
                background: #2c3e50;
                color: white;
                padding: 0;
                gap: 0;
                justify-content: center;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
                z-index: 10;
                position: relative;
            }

            #toolbar button {
                background: #3498db;
                color: white;
                border: none;
                font-size: 1em;
                width: 35px;
                height: 35px;
                cursor: pointer;
                transition: background 0.2s, transform 0.1s;
                box-shadow: none;
                border-radius: 0;
            }

            #toolbar button:active {
                transform: scale(0.95);
            }

            #toolbar button:hover {
                background: #2980b9;
            }

            .toolbar-separator {
                width: 1px;
                background-color: #446688;
                height: 35px;
            }

            #main-container {
                width: 100%;
                height: calc(100vh - 35px);
                position: relative;
            }

            #code-panel,
            #view-panel,
            #settings-panel,
            #editor-code-panel {
                position: absolute;
                width: 100%;
                height: 100%;
                display: none;
                background: white;
            }

            #code-panel,
            #editor-code-panel {
                background: #1e1e1e;
                color: #f8f8f8;
            }

            #settings-panel {
                background: #282c34;
                color: #f8f8f8;
                padding: 20px;
                box-sizing: border-box;
                overflow-y: auto;
            }

            #settings-panel h2 {
                color: #61afef;
                border-bottom: 2px solid #545862;
                padding-bottom: 10px;
                margin-bottom: 20px;
            }

            #settings-panel label {
                font-size: 1em;
                color: #a0a0a0;
                margin-bottom: 5px;
            }

            #settings-panel input[type='number'],
            #settings-panel input[type='text'] {
                width: 80px;
                padding: 5px;
                background: #3e4451;
                border: 1px solid #545862;
                color: #f8f8f8;
                border-radius: 4px;
                margin-left: 10px;
            }

            #save-settings-btn {
                background: #28a745;
                color: white;
                border: none;
                padding: 10px 15px;
                border-radius: 5px;
                cursor: pointer;
                margin-top: 20px;
            }

            #save-settings-btn:hover {
                background: #218838;
            }
            
            #clear-cache-btn {
                background: #dc3545;
                color: white;
                border: none;
                padding: 10px 15px;
                border-radius: 5px;
                cursor: pointer;
                margin-top: 20px;
            }
            
            #clear-cache-btn:hover {
                background: #c82333;
            }

            #three-canvas {
                width: 100%;
                height: 100%;
                display: block;
            }

            .modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                display: none;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            }

            .modal-content {
                background: #282c34;
                width: 100%;
                height: 100%;
                max-width: 100%;
                max-height: 100%;
            }
        </style>

        <script type="importmap">
            {
                "imports": {
                    "three": "./build/three.module.js",
                    "three/addons/": "./jsm/",
                    "three-mesh-bvh": "./js/mesh-bvh.js",
                    "three-bvh-csg": "./js/csg-bvh.js"
                }
            }
        </script>
    </head>
    <body>
        <div id="toolbar">
            <button id="btn-3d" title="3D View">&#x1F5BC;</button>
            <div class="toolbar-separator"></div>
            <button id="btn-code" title="CSG Code Editor">&#x1F4BB;</button>
            <div class="toolbar-separator"></div>
            <button id="btn-editor-code" title="Editor Code">&#x2B9D;</button>
            <div class="toolbar-separator"></div>
            <button id="btn-settings" title="Settings">&#x2699;</button>
            <div class="toolbar-separator"></div>
            <button id="btn-load" title="Load Project">&#x1F4E5;</button>
            <div class="toolbar-separator"></div>
            <button id="btn-save" title="Save Project">&#x1F4BE;</button>
        </div>

        <div id="main-container">
            <div id="code-panel">
                <textcode
                    id="csg-code"
                    title="CSG Script"
                    onrun="runCSGCode();">
                    // Edit and save to update!
/*
return floor(
	difference(
		color(0x0000ffff,sphere({ r: 20, fn:100 })),
		translate([15, 0, 0], cube([20, 20, 20])),
		translate([0, 0, 15], cylinder({ r: 20, h: 30 , fn:100}))
	)
);
*/
//return cube([40, 50, 60]);
/*
var b1= floor(
	translate([30,0,0],
		cylinder({d:10, h:20, fn:50})
	)
);

var b2= floor(
	translate([0,0,0],
		cube([10,10,10])
	)
);

return {
	b1:{
	data:b1,
	show:true
	},
	b2:{
		data:b2,
		show:true
		}
	};
	*/
	
	return translate([30,0,0],
	union(
	
	translate([5,5,0],
		color(0xffff0000, cube([10,10,10]))
	),
	translate([0,0,0],
		cube([10,10,10])
	)
	
	)
	);
	
	
                </textcode>
            </div>

            <div id="editor-code-panel">
                <textcode
                    id="editor-code"
                    title="Editor Script"
					onrun="runEditorScript();">
                    // Place reusable functions and objects here.
                    // Access from CSG Script with include("page name");
                    /*
                    var constants = {
                        PI: Math.PI,
                        E: Math.E
                    };
                    return { constants };
                    */
                </textcode>
            </div>

            <div id="view-panel">
                <canvas id="three-canvas"></canvas>
            </div>

            <div id="settings-panel">
                <h2>Settings</h2>
                <label for="width-input">Grid Width:</label>
                <input type="number" id="width-input" value="220" />
                mm<br /><br />
                <label for="length-input">Grid Length:</label>
                <input type="number" id="length-input" value="220" />
                mm<br /><br />
                <label for="grid-size-input">Grid Spacing:</label>
                <input type="number" id="grid-size-input" value="10" />
                mm<br /><br />
                <label for="library-path-input">Library Path:</label>
                <input type="text" id="library-path-input" value="/csgLib" /><br /><br />
                <button id="save-settings-btn">Save Settings</button>
                <button id="clear-cache-btn">Clear All Cache</button>
            </div>
        </div>

        <div id="load-code-modal" class="modal-overlay">
            <div class="modal-content">
                <filepicker
                    id="load-picker"
                    useFileButtonText="Load Code"
                    onfilepick="handleLoadFile(event, filePath)"
                    oncancel="closeModal('load-code-modal')">
                </filepicker>
            </div>
        </div>

        <div id="save-code-modal" class="modal-overlay">
            <div class="modal-content">
                <filepicker
                    id="save-picker"
                    useFileButtonText="Save Code"
                    onfilepick="handleSaveFile(event, filePath)"
                    oncancel="closeModal('save-code-modal')">
                </filepicker>
            </div>
        </div>

        <div id="save-stl-modal" class="modal-overlay">
            <div class="modal-content">
                <filepicker
                    id="save-stl-picker"
                    useFileButtonText="Save STL"
                    onfilepick="handleSaveStl(event, filePath)"
                    oncancel="closeModal('save-stl-modal')">
                </filepicker>
            </div>
        </div>

        <script type="module" src="/ux/textCode.js"></script>
        <script type="module" src="/ux/filePicker.js"></script>
        
        <script type="module">
            import { initialize, openModal, closeModal, runCSGCode, runEditorScript, handleLoadFile, handleSaveFile, handleSaveStl, exportSTL } from './js/editorCsg.js';
            
            // Make these functions available globally for the HTML event handlers
            window.openModal = openModal;
            window.closeModal = closeModal;
            window.runCSGCode = runCSGCode;
            window.runEditorScript = runEditorScript;
            window.handleLoadFile = handleLoadFile;
            window.handleSaveFile = handleSaveFile;
            window.handleSaveStl = handleSaveStl;
            
            window.onload = function() {
                // Collect all the DOM elements and pass them to the initializer function
                const domElements = {
                    btn3D: document.getElementById('btn-3d'),
                    btnCode: document.getElementById('btn-code'),
                    btnEditorCode: document.getElementById('btn-editor-code'),
                    btnSettings: document.getElementById('btn-settings'),
                    btnLoad: document.getElementById('btn-load'),
                    btnSave: document.getElementById('btn-save'),
                    widthInput: document.getElementById('width-input'),
                    lengthInput: document.getElementById('length-input'),
                    gridSizeInput: document.getElementById('grid-size-input'),
                    libraryPathInput: document.getElementById('library-path-input'),
                    saveSettingsBtn: document.getElementById('save-settings-btn'),
                    clearCacheBtn: document.getElementById('clear-cache-btn'),
                    csgEditor: document.getElementById('csg-code'),
                    editorCodeEditor: document.getElementById('editor-code'),
                    codePanel: document.getElementById('code-panel'),
                    editorCodePanel: document.getElementById('editor-code-panel'),
                    viewPanel: document.getElementById('view-panel'),
                    settingsPanel: document.getElementById('settings-panel'),
                    canvas: document.getElementById('three-canvas')
                };
                
                initialize(domElements);
            };
        </script>
    </body>
</html>



